<!doctype html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parle avec Mimi — French AI Tutor</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="header">
      <h1>Parle avec Mimi <span class="badge">v2</span></h1>
      <div class="status" id="status">⏳ prêt</div>
    </header>

    <!-- Async (Celery + Supabase) -->
    <section class="card">
      <h2>Traitement asynchrone (OCR → leçon)</h2>
      <div class="grid2">
        <label>
          <span>Child ID (uuid)</span>
          <input id="childId" placeholder="00000000-0000-0000-0000-000000000000" />
        </label>
        <label>
          <span>Storage path (bucket/path/file.pdf)</span>
          <input id="filePath" placeholder="uploads/uid/book.pdf" />
        </label>
      </div>
      <div class="row">
        <label class="grow">
          <span>Auth (Bearer token) — optionnel</span>
          <input id="authToken" placeholder="eyJhbGciOi..." />
        </label>
        <button id="btnAsync" type="button" class="btn">🚀 Lancer traitement (async)</button>
      </div>
      <div class="log" id="asyncLog"></div>
      <div id="asyncLesson"></div>
    </section>

    <!-- Sync lesson builder (Mimi JSON) -->
    <section class="card">
      <h2>Leçon immédiate (sync)</h2>
      <div class="grid2">
        <label>
          <span>Sujet</span>
          <input id="topic" placeholder="Les nombres, la famille, les couleurs..." />
        </label>
        <label>
          <span>Âge</span>
          <input id="age" type="number" min="5" max="14" value="11" />
        </label>
      </div>
      <label>
        <span>Texte OCR (optionnel)</span>
        <textarea id="pdfText" rows="5" placeholder="Collez un extrait du PDF…"></textarea>
      </label>
      <div class="row">
        <button id="btnBuild" type="button" class="btn">✨ Construire la leçon (sync)</button>
        <button id="btnGenImgs" type="button" class="btn btn-alt">🖼️ Générer images</button>
      </div>
      <div id="syncLesson"></div>
      <div id="imagePreview"></div>
      <div id="imageTabs" class="image-tabs"></div>
    </section>

    <!-- Tutor chat -->
    <section class="card">
      <h2>Chat avec Mimi</h2>
      <div class="chat" id="chatBox"></div>
      <div class="row">
        <input id="chatInput" class="grow" placeholder="Tape ton message…" />
        <button id="btnSend" type="button" class="btn">💬 Envoyer</button>
        <button id="btnSpeak" type="button" class="btn btn-alt">🔈 Lire</button>
      </div>
    </section>

    <footer class="muted">
      <small>Made with ❤️ — Mimi le tuteur</small>
    </footer>
  </div>

  <script src="./app.js"></script>
</body>
</html>
